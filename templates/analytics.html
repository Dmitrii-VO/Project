{% extends "base.html" %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - Telegram Mini App{% endblock %}

{% block extra_css %}
    <!-- Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="hero-section animate-fade-in">
        <button class="back-btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="hero-content">
            <span class="hero-icon">üìä</span>
            <h1 class="hero-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
            <p class="hero-subtitle">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤ –∏ –æ—Ñ—Ñ–µ—Ä–æ–≤</p>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card animate-fade-in animate-delay-100">
            <div class="stat-icon">üëÅÔ∏è</div>
            <div class="stat-number" id="total-views">
                <span class="loading-skeleton">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
        </div>

        <div class="stat-card animate-fade-in animate-delay-200">
            <div class="stat-icon">üëÜ</div>
            <div class="stat-number" id="click-rate">
                <span class="loading-skeleton">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="stat-label">CTR</div>
        </div>

        <div class="stat-card animate-fade-in animate-delay-300">
            <div class="stat-icon">üí∞</div>
            <div class="stat-number" id="total-revenue">
                <span class="loading-skeleton">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="stat-label">–î–æ—Ö–æ–¥</div>
        </div>

        <div class="stat-card animate-fade-in animate-delay-400">
            <div class="stat-icon">üìà</div>
            <div class="stat-number" id="conversion-rate">
                <span class="loading-skeleton">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="stat-label">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
        </div>
    </div>

    <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±—ã -->
    <div class="tabs">
        <nav class="tabs-nav">
            <li><a href="#" class="active" data-tab="overview">–û–±–∑–æ—Ä</a></li>
            <li><a href="#" data-tab="channels">–ü–æ –∫–∞–Ω–∞–ª–∞–º</a></li>
            <li><a href="#" data-tab="offers">–ü–æ –æ—Ñ—Ñ–µ—Ä–∞–º</a></li>
            <li><a href="#" data-tab="revenue">–î–æ—Ö–æ–¥—ã</a></li>
        </nav>
    </div>

    <!-- Tab: –û–±–∑–æ—Ä -->
    <div class="tabs-content active" id="overview">
        <!-- Charts Container -->
        <div class="stats-grid">
            <div class="card animate-slide-in animate-delay-100">
                <div class="card-header">
                    <h3 class="card-title">–î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</h3>
                    <p class="card-subtitle">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</p>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="viewsChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card animate-slide-in animate-delay-200">
                <div class="card-header">
                    <h3 class="card-title">–°—Ç–∞—Ç—É—Å—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</h3>
                    <p class="card-subtitle">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–∫–ª–∏–∫–æ–≤</p>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="proposalsChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card animate-slide-in animate-delay-300">
                <div class="card-header">
                    <h3 class="card-title">–†–∞—Å—Ö–æ–¥—ã –ø–æ –¥–Ω—è–º</h3>
                    <p class="card-subtitle">–î–∏–Ω–∞–º–∏–∫–∞ —Ç—Ä–∞—Ç</p>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="spendingChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card animate-slide-in animate-delay-400">
                <div class="card-header">
                    <h3 class="card-title">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                    <p class="card-subtitle">–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</p>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab: –ü–æ –∫–∞–Ω–∞–ª–∞–º -->
    <div class="tabs-content" id="channels">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üì∫ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞–Ω–∞–ª–∞–º</h3>
                <p class="card-subtitle">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞</p>
            </div>
            <div class="card-body">
                <div class="empty-state">
                    <div class="stat-icon">üì∫</div>
                    <h3>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞–Ω–∞–ª–∞–º</h3>
                    <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –∏–∑ –≤–∞—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤.</p>
                    <div class="notification notification-info">
                        <div class="notification-content">
                            <div class="notification-title">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                            <div class="notification-message">
                                –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–æ—Ö–æ–¥–∞–º, –æ—Ö–≤–∞—Ç–∞–º –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab: –ü–æ –æ—Ñ—Ñ–µ—Ä–∞–º -->
    <div class="tabs-content" id="offers">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üì¢ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –æ—Ñ—Ñ–µ—Ä–∞–º</h3>
                <p class="card-subtitle">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π</p>
            </div>
            <div class="card-body">
                <div class="empty-state">
                    <div class="stat-icon">üì¢</div>
                    <h3>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –æ—Ñ—Ñ–µ—Ä–∞–º</h3>
                    <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–∞—à–∏—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π.</p>
                    <div class="notification notification-info">
                        <div class="notification-content">
                            <div class="notification-title">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                            <div class="notification-message">
                                –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ CTR, –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏ ROI –≤–∞—à–∏—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab: –î–æ—Ö–æ–¥—ã -->
    <div class="tabs-content" id="revenue">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üí∏ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                <p class="card-subtitle">–î–æ—Ö–æ–¥—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã</p>
            </div>
            <div class="card-body">
                <div class="empty-state">
                    <div class="stat-icon">üí∏</div>
                    <h3>–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                    <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã –¥–æ—Ö–æ–¥–æ–≤.</p>
                    <div class="notification notification-info">
                        <div class="notification-content">
                            <div class="notification-title">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                            <div class="notification-message">
                                –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–æ—Ö–æ–¥–∞–º, —Ç—Ä–µ–Ω–¥–∞–º –∏ –ø—Ä–æ–≥–Ω–æ–∑–∞–º –∑–∞—Ä–∞–±–æ—Ç–∫–∞.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
<script src="{{ url_for('static', filename='js/utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>

<script>
// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–æ–≤
function switchTab(tabName) {
    // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-nav a').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
    const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
    const activeContent = document.getElementById(tabName);
    
    if (activeTab) activeTab.classList.add('active');
    if (activeContent) activeContent.classList.add('active');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç–∞–±–∞–º
document.addEventListener('DOMContentLoaded', function() {
    console.log('üìä –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-nav a').forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const tabName = this.getAttribute('data-tab');
            switchTab(tabName);
        });
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    loadAnalyticsData();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
    initializeCharts();
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
function goBack() {
    window.history.back();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
function loadAnalyticsData() {
    // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    setTimeout(() => {
        document.getElementById('total-views').innerHTML = '1,234,567';
        document.getElementById('click-rate').innerHTML = '3.8%';
        document.getElementById('total-revenue').innerHTML = '‚ÇΩ 45,230';
        document.getElementById('conversion-rate').innerHTML = '2.1%';
    }, 1000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
function initializeCharts() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Chart.js
    if (typeof Chart !== 'undefined') {
        // –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
        const viewsCtx = document.getElementById('viewsChart');
        if (viewsCtx) {
            new Chart(viewsCtx, {
                type: 'line',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
                    datasets: [{
                        label: '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã',
                        data: [1200, 1900, 3000, 5000, 2000, 3000, 4500, 6000, 7000, 8000],
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
        const proposalsCtx = document.getElementById('proposalsChart');
        if (proposalsCtx) {
            new Chart(proposalsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['–ü—Ä–∏–Ω—è—Ç–æ', '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ', '–û–∂–∏–¥–∞–µ—Ç'],
                    datasets: [{
                        data: [65, 25, 10],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(251, 191, 36, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤
        const spendingCtx = document.getElementById('spendingChart');
        if (spendingCtx) {
            new Chart(spendingCtx, {
                type: 'bar',
                data: {
                    labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
                    datasets: [{
                        label: '–†–∞—Å—Ö–æ–¥—ã',
                        data: [3000, 4500, 2800, 6200, 5500, 4000, 3200],
                        backgroundColor: 'rgba(102, 126, 234, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // –ì—Ä–∞—Ñ–∏–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        const efficiencyCtx = document.getElementById('efficiencyChart');
        if (efficiencyCtx) {
            new Chart(efficiencyCtx, {
                type: 'radar',
                data: {
                    labels: ['CTR', '–ö–æ–Ω–≤–µ—Ä—Å–∏—è', 'ROI', '–û—Ö–≤–∞—Ç', '–í–æ–≤–ª–µ—á–µ–Ω–∏–µ'],
                    datasets: [{
                        label: '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
                        data: [65, 59, 90, 81, 56],
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
    } else {
        console.error('Chart.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
}
</script>
{% endblock %}