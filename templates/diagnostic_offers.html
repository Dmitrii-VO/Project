<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ñ—Ñ–µ—Ä–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .diagnostic-panel { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .code-block { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; border-left: 4px solid #007bff; margin: 10px 0; white-space: pre-wrap; }
        .json-viewer { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; overflow-x: auto; }
        .response-box { background: #1a202c; color: #cbd5e0; padding: 15px; border-radius: 8px; font-family: monospace; margin: 10px 0; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ñ—Ñ–µ—Ä–æ–≤</h1>
    
    <div class="diagnostic-panel">
        <h2>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ</h2>
        <div class="test-result error">
            <strong>–û—à–∏–±–∫–∞:</strong> PATCH /api/offers/12/status –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 (BAD REQUEST)<br>
            <strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ñ—Ñ–µ—Ä–∞"
        </div>
    </div>

    <div class="diagnostic-panel">
        <h2>üéØ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã</h2>
        <button class="btn-primary" onclick="testOfferExists()">1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞</button>
        <button class="btn-primary" onclick="testUserAuthentication()">2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é</button>
        <button class="btn-primary" onclick="testOfferDetails()">3. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞</button>
        <button class="btn-secondary" onclick="testStatusChange()">4. –¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞</button>
        <button class="btn-danger" onclick="testDirectAPI()">5. –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç API</button>
        <div id="diagnosticResults"></div>
    </div>

    <div class="diagnostic-panel">
        <h2>üîß –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
        <button class="btn-primary" onclick="analyzeOfferStatus()">–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞</button>
        <button class="btn-primary" onclick="checkStatusTransitions()">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–∞</button>
        <button class="btn-secondary" onclick="simulateStatusChange()">–°–∏–º—É–ª—è—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        <div id="detailedResults"></div>
    </div>

    <div class="diagnostic-panel">
        <h2>üìä –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞</h2>
        <button class="btn-secondary" onclick="enableVerboseLogging()">–í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏</button>
        <button class="btn-secondary" onclick="testAllEndpoints()">–¢–µ—Å—Ç –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤</button>
        <div id="logsResults"></div>
    </div>

    <script>
        let offerId = 12; // ID –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –æ—Ñ—Ñ–µ—Ä–∞
        let userId = '373086959'; // Fallback user ID

        function addResult(containerId, content, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = content;
            container.appendChild(div);
        }

        function formatJSON(obj) {
            return `<div class="json-viewer">${JSON.stringify(obj, null, 2)}</div>`;
        }

        async function testOfferExists() {
            console.log('üîç –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ—Ñ—Ñ–µ—Ä–∞');
            
            try {
                const response = await fetch('/api/offers/my', {
                    headers: {
                        'X-Telegram-User-Id': userId,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    const offer = result.offers.find(o => o.id === offerId);
                    
                    if (offer) {
                        addResult('diagnosticResults', 
                            `‚úÖ <strong>–û—Ñ—Ñ–µ—Ä ${offerId} –Ω–∞–π–¥–µ–Ω</strong><br>
                            –°—Ç–∞—Ç—É—Å: ${offer.status}<br>
                            –ù–∞–∑–≤–∞–Ω–∏–µ: ${offer.title}<br>
                            –°–æ–∑–¥–∞–Ω: ${offer.created_at}
                            ${formatJSON(offer)}`, 'success');
                    } else {
                        addResult('diagnosticResults', 
                            `‚ùå <strong>–û—Ñ—Ñ–µ—Ä ${offerId} –ù–ï –Ω–∞–π–¥–µ–Ω</strong><br>
                            –ù–∞–π–¥–µ–Ω–æ –æ—Ñ—Ñ–µ—Ä–æ–≤: ${result.offers.length}<br>
                            IDs: ${result.offers.map(o => o.id).join(', ')}`, 'error');
                    }
                } else {
                    addResult('diagnosticResults', 
                        `‚ùå <strong>–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ñ—Ñ–µ—Ä–æ–≤:</strong> ${result.error}`, 'error');
                }

            } catch (error) {
                addResult('diagnosticResults', 
                    `‚ùå <strong>–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞:</strong> ${error.message}`, 'error');
            }
        }

        async function testUserAuthentication() {
            console.log('üîç –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏');
            
            try {
                const response = await fetch('/api/offers/debug/user', {
                    method: 'POST',
                    headers: {
                        'X-Telegram-User-Id': userId,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ test: 'auth' })
                });

                const result = await response.json();
                
                if (result.success) {
                    addResult('diagnosticResults', 
                        `‚úÖ <strong>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç</strong><br>
                        User ID: ${result.user_id}<br>
                        –ú–µ—Ç–æ–¥: ${result.method}
                        ${formatJSON(result)}`, 'success');
                } else {
                    addResult('diagnosticResults', 
                        `‚ùå <strong>–ü—Ä–æ–±–ª–µ–º–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π:</strong> ${result.error}`, 'error');
                }

            } catch (error) {
                addResult('diagnosticResults', 
                    `‚ùå <strong>–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:</strong> ${error.message}`, 'error');
            }
        }

        async function testOfferDetails() {
            console.log('üîç –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ—Ñ—Ñ–µ—Ä–∞');
            
            try {
                const response = await fetch(`/api/offers/detail/${offerId}?include_responses=true`, {
                    headers: {
                        'X-Telegram-User-Id': userId,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    addResult('diagnosticResults', 
                        `‚úÖ <strong>–î–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω—ã</strong><br>
                        ID: ${result.offer.id}<br>
                        –°—Ç–∞—Ç—É—Å: ${result.offer.status}<br>
                        –°–æ–∑–¥–∞—Ç–µ–ª—å: ${result.offer.creator_username}<br>
                        –û—Ç–∫–ª–∏–∫–æ–≤: ${result.offer.responses ? result.offer.responses.length : 0}
                        ${formatJSON(result.offer)}`, 'success');
                } else {
                    addResult('diagnosticResults', 
                        `‚ùå <strong>–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π:</strong> ${result.error}`, 'error');
                }

            } catch (error) {
                addResult('diagnosticResults', 
                    `‚ùå <strong>–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–µ—Ç–∞–ª–µ–π:</strong> ${error.message}`, 'error');
            }
        }

        async function testStatusChange() {
            console.log('üîç –¢–µ—Å—Ç 4: –¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–∞
            const testCases = [
                { from: 'active', to: 'paused', reason: '–¢–µ—Å—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏' },
                { from: 'active', to: 'cancelled', reason: '–¢–µ—Å—Ç –æ—Ç–º–µ–Ω—ã' },
                { from: 'paused', to: 'active', reason: '–¢–µ—Å—Ç –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' }
            ];

            for (const testCase of testCases) {
                try {
                    console.log(`–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ö–æ–¥ ${testCase.from} ‚Üí ${testCase.to}`);
                    
                    const response = await fetch(`/api/offers/${offerId}/status`, {
                        method: 'PATCH',
                        headers: {
                            'X-Telegram-User-Id': userId,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            status: testCase.to,
                            reason: testCase.reason
                        })
                    });

                    const result = await response.json();
                    
                    addResult('diagnosticResults', 
                        `<strong>–ü–µ—Ä–µ—Ö–æ–¥ ${testCase.from} ‚Üí ${testCase.to}:</strong><br>
                        Status: ${response.status}<br>
                        Success: ${result.success}<br>
                        ${result.success ? '‚úÖ' : '‚ùå'} ${result.message || result.error}
                        ${formatJSON({ request: testCase, response: result })}`, 
                        result.success ? 'success' : 'error');

                    // –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                    if (result.success) break;

                } catch (error) {
                    addResult('diagnosticResults', 
                        `‚ùå <strong>–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ${testCase.from} ‚Üí ${testCase.to}:</strong> ${error.message}`, 'error');
                }
            }
        }

        async function testDirectAPI() {
            console.log('üîç –¢–µ—Å—Ç 5: –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç API');
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º —Ç–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–∑ –æ—à–∏–±–∫–∏
            const requestData = {
                status: 'cancelled',
                reason: '–¢–µ—Å—Ç –æ—Ç–º–µ–Ω—ã —á–µ—Ä–µ–∑ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É'
            };

            try {
                console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–∑ –æ—à–∏–±–∫–∏...');
                
                const response = await fetch(`/api/offers/${offerId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'X-Telegram-User-Id': userId,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                let result;
                try {
                    result = await response.json();
                } catch (parseError) {
                    result = { error: '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –æ—Ç–≤–µ—Ç', text: await response.text() };
                }

                addResult('diagnosticResults', 
                    `<strong>–ü—Ä—è–º–æ–π API —Ç–µ—Å—Ç:</strong><br>
                    HTTP Status: ${response.status} ${response.statusText}<br>
                    Content-Type: ${response.headers.get('content-type')}<br>
                    Success: ${result.success}<br>
                    <div class="response-box">
                    –ó–∞–ø—Ä–æ—Å: ${JSON.stringify(requestData, null, 2)}
                    
                    –û—Ç–≤–µ—Ç: ${JSON.stringify(result, null, 2)}
                    </div>`, 
                    response.ok ? 'success' : 'error');

            } catch (error) {
                addResult('diagnosticResults', 
                    `‚ùå <strong>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä—è–º–æ–≥–æ API:</strong> ${error.message}<br>
                    Stack: ${error.stack}`, 'error');
            }
        }

        async function analyzeOfferStatus() {
            console.log('üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ñ—Ñ–µ—Ä–∞');
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –æ—Ñ—Ñ–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞
                const listResponse = await fetch('/api/offers/my', {
                    headers: { 'X-Telegram-User-Id': userId }
                });
                const listResult = await listResponse.json();
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞
                const detailResponse = await fetch(`/api/offers/detail/${offerId}`, {
                    headers: { 'X-Telegram-User-Id': userId }
                });
                const detailResult = await detailResponse.json();

                const offer = listResult.offers?.find(o => o.id === offerId);
                
                addResult('detailedResults', 
                    `<strong>–ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ñ—Ñ–µ—Ä–∞ ${offerId}:</strong><br>
                    –í —Å–ø–∏—Å–∫–µ: ${offer ? `—Å—Ç–∞—Ç—É—Å "${offer.status}"` : '–ù–ï –ù–ê–ô–î–ï–ù'}<br>
                    –í –¥–µ—Ç–∞–ª—è—Ö: ${detailResult.success ? `—Å—Ç–∞—Ç—É—Å "${detailResult.offer.status}"` : '–û–®–ò–ë–ö–ê'}<br>
                    
                    <strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "${offer?.status}":</strong><br>
                    ‚Ä¢ active ‚Üí paused, cancelled, completed<br>
                    ‚Ä¢ paused ‚Üí active, cancelled, completed<br>
                    ‚Ä¢ cancelled ‚Üí (–Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤)<br>
                    ‚Ä¢ completed ‚Üí (–Ω–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–æ–≤)
                    
                    ${offer ? formatJSON(offer) : ''}`, 
                    offer ? 'info' : 'error');

            } catch (error) {
                addResult('detailedResults', 
                    `‚ùå <strong>–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:</strong> ${error.message}`, 'error');
            }
        }

        async function checkStatusTransitions() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–∞');
            
            const transitions = {
                'active': ['paused', 'cancelled', 'completed'],
                'paused': ['active', 'cancelled', 'completed'],
                'cancelled': [],
                'completed': []
            };

            let html = '<strong>–ú–∞—Ç—Ä–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å—Ç–∞—Ç—É—Å–∞:</strong><br>';
            
            for (const [from, toList] of Object.entries(transitions)) {
                html += `<br><strong>${from}:</strong> `;
                if (toList.length > 0) {
                    html += toList.join(', ');
                } else {
                    html += '–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤';
                }
            }

            html += '<br><br><strong>–ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –æ—Ñ—Ñ–µ—Ä–∞...</strong>';

            addResult('detailedResults', html, 'info');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
            try {
                const response = await fetch('/api/offers/my', {
                    headers: { 'X-Telegram-User-Id': userId }
                });
                const result = await response.json();
                const offer = result.offers?.find(o => o.id === offerId);

                if (offer) {
                    const currentStatus = offer.status;
                    const availableTransitions = transitions[currentStatus] || [];
                    
                    addResult('detailedResults', 
                        `<strong>–°—Ç–∞—Ç—É—Å –æ—Ñ—Ñ–µ—Ä–∞ ${offerId}: "${currentStatus}"</strong><br>
                        –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã: ${availableTransitions.length > 0 ? availableTransitions.join(', ') : '–ù–ï–¢'}<br>
                        ${availableTransitions.length === 0 ? '‚ùå –≠—Ç–æ—Ç –æ—Ñ—Ñ–µ—Ä –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å (—Å—Ç–∞—Ç—É—Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π)' : '‚úÖ –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å'}`, 
                        availableTransitions.length > 0 ? 'success' : 'warning');
                } else {
                    addResult('detailedResults', `‚ùå –û—Ñ—Ñ–µ—Ä ${offerId} –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'error');
                }

            } catch (error) {
                addResult('detailedResults', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`, 'error');
            }
        }

        async function simulateStatusChange() {
            console.log('üîç –°–∏–º—É–ª—è—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞');
            
            // –°–æ–∑–¥–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            const simulationData = {
                offerId: offerId,
                newStatus: 'paused',
                reason: '–°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏',
                userId: userId,
                timestamp: new Date().toISOString()
            };

            addResult('detailedResults', 
                `<strong>–°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:</strong><br>
                URL: PATCH /api/offers/${offerId}/status<br>
                Headers: X-Telegram-User-Id: ${userId}<br>
                Body: ${JSON.stringify({ status: 'paused', reason: '–°–∏–º—É–ª—è—Ü–∏—è' }, null, 2)}<br>
                
                <strong>–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:</strong><br>
                ‚Ä¢ 200 OK + {"success": true, "message": "–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω"}<br>
                ‚Ä¢ 400 Bad Request + {"success": false, "error": "..."}<br>
                ‚Ä¢ 403 Forbidden + {"success": false, "error": "–ù–µ—Ç –ø—Ä–∞–≤"}<br>
                ‚Ä¢ 404 Not Found + {"success": false, "error": "–û—Ñ—Ñ–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω"}`, 'info');
        }

        async function enableVerboseLogging() {
            console.log('üîç –í–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤');
            
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã
            const originalFetch = window.fetch;
            window.fetch = async function(...args) {
                console.log('üì§ FETCH REQUEST:', args);
                
                const response = await originalFetch(...args);
                const clonedResponse = response.clone();
                
                try {
                    const responseData = await clonedResponse.json();
                    console.log('üì• FETCH RESPONSE:', {
                        url: args[0],
                        status: response.status,
                        headers: Object.fromEntries(response.headers.entries()),
                        data: responseData
                    });
                } catch (e) {
                    const responseText = await clonedResponse.text();
                    console.log('üì• FETCH RESPONSE (text):', {
                        url: args[0],
                        status: response.status,
                        text: responseText
                    });
                }
                
                return response;
            };

            addResult('logsResults', 
                '‚úÖ <strong>–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤–∫–ª—é—á–µ–Ω—ã</strong><br>–í—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å', 'success');
        }

        async function testAllEndpoints() {
            console.log('üîç –¢–µ—Å—Ç –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤');
            
            const endpoints = [
                { method: 'GET', url: '/api/offers/my', desc: '–°–ø–∏—Å–æ–∫ –æ—Ñ—Ñ–µ—Ä–æ–≤' },
                { method: 'GET', url: `/api/offers/detail/${offerId}`, desc: '–î–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞' },
                { method: 'GET', url: '/api/offers/debug/user', desc: '–û—Ç–ª–∞–¥–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' },
                { method: 'PATCH', url: `/api/offers/${offerId}/status`, desc: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞', body: { status: 'paused', reason: 'test' } },
                { method: 'POST', url: `/api/offers/${offerId}/cancel`, desc: '–û—Ç–º–µ–Ω–∞ –æ—Ñ—Ñ–µ—Ä–∞', body: { reason: 'test' } }
            ];

            for (const endpoint of endpoints) {
                try {
                    const options = {
                        method: endpoint.method,
                        headers: {
                            'X-Telegram-User-Id': userId,
                            'Content-Type': 'application/json'
                        }
                    };

                    if (endpoint.body) {
                        options.body = JSON.stringify(endpoint.body);
                    }

                    const response = await fetch(endpoint.url, options);
                    const result = await response.json();

                    addResult('logsResults', 
                        `<strong>${endpoint.method} ${endpoint.url}</strong> (${endpoint.desc})<br>
                        Status: ${response.status} ${response.statusText}<br>
                        Success: ${result.success ? '‚úÖ' : '‚ùå'}<br>
                        ${result.success ? result.message || 'OK' : result.error || 'Unknown error'}`, 
                        response.ok ? 'success' : 'error');

                } catch (error) {
                    addResult('logsResults', 
                        `‚ùå <strong>${endpoint.method} ${endpoint.url}</strong>: ${error.message}`, 'error');
                }

                // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –±–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ—Ñ—Ñ–µ—Ä–æ–≤');
            
            setTimeout(() => {
                addResult('diagnosticResults', 
                    'üöÄ <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞</strong><br>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞', 'info');
            }, 1000);
        });
    </script>
</body>
</html>