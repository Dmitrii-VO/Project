<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>{% block title %}Telegram Mini App{% endblock %}</title>

    <!-- Telegram WebApp Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-design-system.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/back-button.css') }}">

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-icon">üì±</div>
            <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main id="app-container">
        <!-- ID Badge -->
        <div id="idBadge" class="id-badge" style="display: none;">
            <span id="badgeUserId">---</span>
        </div>
        {% block content %}{% endblock %}
    </main>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div class="toast-container" id="toast-container"></div>

    <!-- –ë–∞–∑–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="{{ url_for('static', filename='js/telegram-app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    {% block extra_scripts %}{% endblock %}

    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingScreen = document.getElementById('loading-screen');
            const appContainer = document.getElementById('app-container');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ TelegramApp –∑–∞–≥—Ä—É–∂–µ–Ω
            if (window.TelegramApp && typeof window.TelegramApp.init === 'function') {
                window.TelegramApp.init();
            } else {
                console.error('‚ùå TelegramApp –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∏–ª–∏ –Ω–µ –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥–∞ init');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                appContainer.classList.add('visible');
            }, 1000);
        });
    </script>
</body>
</html>