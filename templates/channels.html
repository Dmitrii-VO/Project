{% extends "base.html" %}

{% block title %}–ú–æ–∏ –∫–∞–Ω–∞–ª—ã - Telegram Mini App{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/channels-compact.css') }}">
{% endblock %}

{% block content %}
<div class="container">
        <!-- Hero Section -->
        <div class="hero-section animate-fade-in">
            <button class="back-btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="hero-content">
                <span class="hero-icon">üì∫</span>
                <h1 class="hero-title">–ú–æ–∏ –∫–∞–Ω–∞–ª—ã</h1>
                <p class="hero-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º–∏ Telegram –∫–∞–Ω–∞–ª–∞–º–∏</p>
            </div>
        </div>

        <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±—ã -->
        <div class="tabs">
            <nav class="tabs-nav">
                <li><a href="#" class="active" data-tab="channels">–ú–æ–∏ –∫–∞–Ω–∞–ª—ã</a></li>
                <li><a href="#" data-tab="add-channel">–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª</a></li>
                <li><a href="#" data-tab="analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
            </nav>
        </div>

        <!-- Tab: –ú–æ–∏ –∫–∞–Ω–∞–ª—ã -->
        <div class="tabs-content active" id="channels">
            <!-- Action Bar -->
            <div class="form-group">
                <div class="form-input" style="position: relative; max-width: 400px;">
                    <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary);">üîç</span>
                    <input type="text" class="form-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–∞–Ω–∞–ª–∞–º..." id="channelSearch" style="padding-left: 48px;">
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
            <div id="channelsGrid">
                <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
                <div class="empty-state" style="grid-column: 1 / -1; display: none;" id="emptyState">
                    <div class="stat-icon">üì∫</div>
                    <h3>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤</h3>
                    <p>–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è–º–∏</p>
                    <button class="btn btn-primary" onclick="switchTab('add-channel')">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab: –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª -->
        <div class="tabs-content" id="add-channel">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞</h3>
                </div>

                <form class="card-body" id="addChannelForm" onsubmit="submitChannelForm(event)">
                    <!-- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞–Ω–∞–ª–∞–º -->
                    <div class="requirements-block">
                        <div class="requirement-item">
                            <span class="requirement-icon">‚úÖ</span>
                            <div class="requirement-text">
                                <strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞–Ω–∞–ª–∞–º:</strong> —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–º–∏ –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –∏ –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏ —Å –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π –±–æ–ª–µ–µ 500 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤. –ú—ã –Ω–µ —Ä–∞–±–æ—Ç–∞–µ–º —Å –≥—Ä—É–ø–ø–æ–≤—ã–º–∏ —á–∞—Ç–∞–º–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ 18+ –∏ —Å –Ω–µ—á–µ—Å—Ç–Ω—ã–º–∏ –ø–∞–±–ª–∏–∫–∞–º–∏.
                            </div>
                        </div>
                    </div>

                    <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª -->
                    <div class="form-field">
                        <label class="form-label" for="channelUrl">
                            –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª:
                        </label>
                        <div class="form-group">
                            <input type="text" id="channelUrl" class="form-input"
                                   placeholder="https://t.me/appcraft_pro" required>
                        </div>
                    </div>

                    <!-- –°—Ç–æ–∏–º–æ—Å—Ç—å -->
                    <div class="form-field">
                        <label class="form-label" for="channelPrice">
                            –°—Ç–æ–∏–º–æ—Å—Ç—å:
                        </label>
                        <div class="form-group">
                            <input type="number" id="channelPrice" class="form-input"
                                   placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ 24 —á–∞—Å–∞ (–æ—Ç 500‚ÇΩ)" min="500" required>
                        </div>
                        <div class="form-help">
                            –£–∫–∞–∑–∞–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞ —Å—á–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞ —Å–µ—Ä–≤–∏—Å–∞ –∑–∞ –∫–∞–∂–¥—É—é –ø—É–±–ª–∏–∫–∞—Ü–∏—é —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫–æ–º–∏—Å—Å–∏—è –∑–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏–ª–∏ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤.
                        </div>
                    </div>

                    <!-- –ö–æ–Ω—Ç–∞–∫—Ç -->
                    <div class="form-field">
                        <label class="form-label" for="channelContact">
                            –ö–æ–Ω—Ç–∞–∫—Ç:
                        </label>
                        <div class="form-group">
                            <input type="text" id="channelContact" class="form-input"
                                   placeholder="Telegram –∞–∫–∫–∞—É–Ω—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —Å–≤—è–∑–∏" required>
                        </div>
                        <div class="form-help">
                            –£–∫–∞–∂–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ @account. –ú—ã —Å–≤—è–∂–µ–º—Å—è –ø–æ –¥–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–∞–∫—Ç—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–ø–∞–Ω–∏–∏.
                        </div>
                    </div>

                    <!-- –ü—Ä–µ–≤—å—é –∫–∞–Ω–∞–ª–∞ (—Å–∫—Ä—ã—Ç–æ–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div id="channelPreview" class="channel-preview" style="display: none; margin-bottom: var(--space-4);"></div>

                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
                    <div class="form-field">
                        <button type="submit" class="btn btn-primary btn-verification" id="submitBtn">
                            –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tab: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
        <div class="tabs-content" id="analytics">
            <div class="card">
                <div class="card-body" style="text-align: center;">
                    <div class="stat-icon">üìä</div>
                    <h3>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–æ–≤</h3>
                    <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –≤–∞—à–∏–º –∫–∞–Ω–∞–ª–∞–º.</p>
                    <div class="notification notification-info">
                        <div class="notification-content">
                            <div class="notification-title">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                            <div class="notification-message">
                                –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–æ—Ö–æ–¥–∞–º, –æ—Ö–≤–∞—Ç–∞–º –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–∞—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="deleteChannelModal" class="modal-backdrop" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª</h3>
                <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="channel-info" id="deleteChannelInfo">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–Ω–∞–ª–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è -->
                </div>
                <div class="notification notification-warning">
                    <div class="notification-content">
                        <div class="notification-title">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</div>
                        <div class="notification-message">
                            –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ö–∞–Ω–∞–ª –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
                        </div>
                    </div>
                </div>
                <div style="text-align: center; font-weight: 600; color: var(--text-primary); margin: 16px 0;">
                    –í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª?
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="btn btn-error" id="confirmDeleteBtn" onclick="confirmChannelDeletion()">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div id="verificationModal" class="modal-backdrop" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üîê –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–ª–∞–¥–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–º</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="verificationContent">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="btn btn-primary" id="startVerificationBtn" onclick="startVerification()">
                    üöÄ –ù–∞—á–∞—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
                </button>
            </div>
        </div>
    </div>

{% endblock %}

{% block extra_scripts %}
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JS –º–æ–¥—É–ª–µ–π -->
<script src="{{ url_for('static', filename='js/channels-analyzer.js') }}"></script>
<script src="{{ url_for('static', filename='js/channels-core.js') }}"></script>
<script src="{{ url_for('static', filename='js/channels-ui.js') }}"></script>
<script src="{{ url_for('static', filename='js/channels-modals.js') }}"></script>
<script src="{{ url_for('static', filename='js/channels-forms.js') }}"></script>

<script>
// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–æ–≤
function switchTab(tabName) {
    // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-nav a').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
    const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
    const activeContent = document.getElementById(tabName);
    
    if (activeTab) activeTab.classList.add('active');
    if (activeContent) activeContent.classList.add('active');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç–∞–±–∞–º
document.addEventListener('DOMContentLoaded', function() {
    console.log('üì∫ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ submitChannelForm:', typeof window.submitChannelForm);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    console.log('üîç channelUrl —ç–ª–µ–º–µ–Ω—Ç:', document.getElementById('channelUrl'));
    console.log('üîç channelPrice —ç–ª–µ–º–µ–Ω—Ç:', document.getElementById('channelPrice'));
    console.log('üîç channelContact —ç–ª–µ–º–µ–Ω—Ç:', document.getElementById('channelContact'));
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ñ–æ—Ä–º—ã
    const form = document.getElementById('addChannelForm');
    if (form) {
        console.log('üìã –§–æ—Ä–º–∞ –Ω–∞–π–¥–µ–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫');
        form.addEventListener('submit', function(e) {
            console.log('üì§ Form submit event triggered');
            e.preventDefault();
            if (typeof window.submitChannelForm === 'function') {
                return window.submitChannelForm(e);
            } else {
                console.error('‚ùå submitChannelForm –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                alert('–û—à–∏–±–∫–∞: —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        });
    } else {
        console.error('‚ùå –§–æ—Ä–º–∞ addChannelForm –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    }

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-nav a').forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const tabName = this.getAttribute('data-tab');
            switchTab(tabName);
        });
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–Ω–∞–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (typeof loadUserChannels === 'function') {
        loadUserChannels();
    } else {
        console.error('‚ùå –§—É–Ω–∫—Ü–∏—è loadUserChannels –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
function goBack() {
    window.history.back();
}
</script>
{% endblock %}
