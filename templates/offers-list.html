{% extends "base.html" %}

{% block title %}–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã - Telegram Mini App{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="hero-section animate-fade-in">
        <button class="back-btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="hero-content">
            <span class="hero-icon">üéØ</span>
            <h1 class="hero-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã</h1>
            <p class="hero-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –≤–∞—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤</p>
        </div>
    </div>

    <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±—ã -->
    <div class="tabs">
        <nav class="tabs-nav">
            <li><a href="#" class="active" data-tab="all-offers">–í—Å–µ –æ—Ñ—Ñ–µ—Ä—ã</a></li>
            <li><a href="#" data-tab="my-responses">–ú–æ–∏ –æ—Ç–∫–ª–∏–∫–∏</a></li>
            <li><a href="#" data-tab="favorites">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a></li>
        </nav>
    </div>

    <!-- Tab: –í—Å–µ –æ—Ñ—Ñ–µ—Ä—ã -->
    <div class="tabs-content active" id="all-offers">
        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üîß –§–∏–ª—å—Ç—Ä—ã</h3>
                <p class="card-subtitle">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–∏—Å–∫ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</p>
            </div>
            <div class="card-body">
                <div class="form-field">
                    <label class="form-label" for="categoryFilter">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="form-select" id="categoryFilter">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="tech">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</option>
                        <option value="finance">–§–∏–Ω–∞–Ω—Å—ã</option>
                        <option value="lifestyle">–°—Ç–∏–ª—å –∂–∏–∑–Ω–∏</option>
                        <option value="education">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                        <option value="business">–ë–∏–∑–Ω–µ—Å</option>
                        <option value="entertainment">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                    </select>
                </div>

                <div class="form-field">
                    <label class="form-label" for="budgetFilter">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç</label>
                    <div class="form-group">
                        <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary);">‚ÇΩ</span>
                        <input type="number" class="form-input" id="budgetFilter" placeholder="1000" min="1" style="padding-left: 32px;">
                    </div>
                </div>

                <div class="form-field">
                    <label class="form-label" for="subscribersFilter">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏</label>
                    <input type="number" class="form-input" id="subscribersFilter" placeholder="–ú–∏–Ω. –ø–æ–¥–ø–∏—Å—á–∏–∫–∏" min="0">
                </div>

                <div class="form-field">
                    <button class="btn btn-primary" onclick="applyFilters()">üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    <button class="btn btn-secondary" onclick="clearFilters()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –æ—Ñ—Ñ–µ—Ä–æ–≤ -->
        <div id="offersContainer" class="stats-grid">
            <!-- –û—Ñ—Ñ–µ—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loadingSpinner" class="empty-state" style="display: none;">
            <div class="stat-icon">‚è≥</div>
            <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ñ—Ñ–µ—Ä–æ–≤...</h3>
            <p>–ü–æ–∏—Å–∫ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –≤–∞—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤</p>
        </div>

        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="stat-icon">üîç</div>
            <h3>–û—Ñ—Ñ–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –ø–æ–∑–∂–µ</p>
            <button class="btn btn-primary" onclick="clearFilters()">
                üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
            </button>
        </div>
    </div>

    <!-- Tab: –ú–æ–∏ –æ—Ç–∫–ª–∏–∫–∏ -->
    <div class="tabs-content" id="my-responses">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìù –ú–æ–∏ –æ—Ç–∫–ª–∏–∫–∏</h3>
                <p class="card-subtitle">–í–∞—à–∏ –æ—Ç–∫–ª–∏–∫–∏ –Ω–∞ –æ—Ñ—Ñ–µ—Ä—ã –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å—ã</p>
            </div>
            <div class="card-body">
                <div class="empty-state">
                    <div class="stat-icon">üìù</div>
                    <h3>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫–ª–∏–∫–æ–≤</h3>
                    <p>–ö–æ–≥–¥–∞ –≤—ã –æ—Ç–∫–ª–∏–∫–Ω–µ—Ç–µ—Å—å –Ω–∞ –æ—Ñ—Ñ–µ—Ä—ã, –æ–Ω–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å</p>
                    <button class="btn btn-primary" onclick="switchTab('all-offers')">
                        üéØ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ñ—Ñ–µ—Ä—ã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
    <div class="tabs-content" id="favorites">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã</h3>
                <p class="card-subtitle">–û—Ñ—Ñ–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</p>
            </div>
            <div class="card-body">
                <div class="empty-state">
                    <div class="stat-icon">‚≠ê</div>
                    <h3>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ</h3>
                    <p>–î–æ–±–∞–≤–ª—è–π—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
                    <button class="btn btn-primary" onclick="switchTab('all-offers')">
                        üéØ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ñ—Ñ–µ—Ä—ã
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ñ—Ñ–µ—Ä–µ -->
<div id="offerModal" class="modal-backdrop" style="display: none;">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">–î–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞</h3>
            <button class="modal-close" onclick="closeOfferModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="offerDetails">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω JavaScript -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeOfferModal()">
                –ó–∞–∫—Ä—ã—Ç—å
            </button>
            <button class="btn btn-primary" id="respondBtn" onclick="respondToOffer()">
                üì© –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –æ—Ñ—Ñ–µ—Ä -->
<div id="responseModal" class="modal-backdrop" style="display: none;">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">–û—Ç–∫–ª–∏–∫ –Ω–∞ –æ—Ñ—Ñ–µ—Ä</h3>
            <button class="modal-close" onclick="closeResponseModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="responseOfferDetails">
                <!-- –î–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JavaScript -->
            </div>
            <div class="form-field">
                <label for="responseMessage" class="form-label">–°–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—é <span class="required">*</span></label>
                <textarea id="responseMessage" class="form-input" rows="4" 
                         placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –ø–æ—á–µ–º—É –≤–∞—à –∫–∞–Ω–∞–ª –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ñ—Ñ–µ—Ä–∞..." required></textarea>
                <div class="form-help">–û–ø–∏—à–∏—Ç–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞ –∏ —É—Å–ª–æ–≤–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeResponseModal()">
                –û—Ç–º–µ–Ω–∞
            </button>
            <button class="btn btn-primary" onclick="submitResponse()">
                üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∫–ª–∏–∫
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/offers.js') }}"></script>

<script>
// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–æ–≤
function switchTab(tabName) {
    // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-nav a').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
    const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
    const activeContent = document.getElementById(tabName);
    
    if (activeTab) activeTab.classList.add('active');
    if (activeContent) activeContent.classList.add('active');
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç–∞–±–∞–º
document.addEventListener('DOMContentLoaded', function() {
    console.log('üéØ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ñ—Ñ–µ—Ä–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    document.querySelectorAll('.tabs-nav a').forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const tabName = this.getAttribute('data-tab');
            switchTab(tabName);
        });
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –æ—Ñ—Ñ–µ—Ä–æ–≤
    if (typeof AvailableOffersManager !== 'undefined') {
        new AvailableOffersManager();
    } else {
        console.warn('AvailableOffersManager –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ');
        loadMockOffers();
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
function goBack() {
    window.history.back();
}

// –§—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
function applyFilters() {
    const category = document.getElementById('categoryFilter').value;
    const budget = document.getElementById('budgetFilter').value;
    const subscribers = document.getElementById('subscribersFilter').value;
    
    console.log('–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', { category, budget, subscribers });
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
    showLoading();
    
    // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    setTimeout(() => {
        hideLoading();
        // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        loadMockOffers();
    }, 1000);
}

function clearFilters() {
    document.getElementById('categoryFilter').value = '';
    document.getElementById('budgetFilter').value = '';
    document.getElementById('subscribersFilter').value = '';
    
    console.log('–§–∏–ª—å—Ç—Ä—ã –æ—á–∏—â–µ–Ω—ã');
    loadMockOffers();
}

// –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
function showLoading() {
    document.getElementById('loadingSpinner').style.display = 'block';
    document.getElementById('offersContainer').style.display = 'none';
    document.getElementById('emptyState').style.display = 'none';
}

function hideLoading() {
    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('offersContainer').style.display = 'grid';
}

function showEmptyState() {
    document.getElementById('emptyState').style.display = 'block';
    document.getElementById('offersContainer').style.display = 'none';
    document.getElementById('loadingSpinner').style.display = 'none';
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
function loadMockOffers() {
    const container = document.getElementById('offersContainer');
    
    // –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    const mockOffers = [
        {
            id: 1,
            title: '–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ IT-–∫—É—Ä—Å–æ–≤',
            budget: 50000,
            category: 'tech',
            description: '–ò—â–µ–º –∫–∞–Ω–∞–ª—ã –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è',
            minSubscribers: 10000,
            price: 2500
        },
        {
            id: 2,
            title: '–†–µ–∫–ª–∞–º–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —É—Å–ª—É–≥',
            budget: 75000,
            category: 'finance',
            description: '–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö —É—Å–ª—É–≥',
            minSubscribers: 25000,
            price: 4000
        },
        {
            id: 3,
            title: '–ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–Ω–∏–Ω–≥–∏',
            budget: 30000,
            category: 'business',
            description: '–†–µ–∫–ª–∞–º–∞ –∫—É—Ä—Å–æ–≤ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –±–∏–∑–Ω–µ—Å–∞ –∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤—É',
            minSubscribers: 15000,
            price: 3000
        }
    ];
    
    container.innerHTML = mockOffers.map(offer => `
        <div class="card animate-fade-in">
            <div class="card-body">
                <div class="offer-header">
                    <h4 class="offer-title">${offer.title}</h4>
                    <div class="offer-price">‚ÇΩ ${offer.price.toLocaleString()}</div>
                </div>
                <p class="offer-description">${offer.description}</p>
                <div class="offer-stats">
                    <div class="offer-stat">
                        <span class="stat-label">–ë—é–¥–∂–µ—Ç:</span>
                        <span class="stat-value">‚ÇΩ ${offer.budget.toLocaleString()}</span>
                    </div>
                    <div class="offer-stat">
                        <span class="stat-label">–ú–∏–Ω. –ø–æ–¥–ø–∏—Å—á–∏–∫–∏:</span>
                        <span class="stat-value">${offer.minSubscribers.toLocaleString()}</span>
                    </div>
                </div>
                <div class="offer-actions">
                    <button class="btn btn-outline" onclick="viewOfferDetails(${offer.id})">
                        üëÅÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </button>
                    <button class="btn btn-primary" onclick="respondToOffer(${offer.id})">
                        üì© –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ñ—Ñ–µ—Ä–∞–º–∏
function viewOfferDetails(offerId) {
    console.log('–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –æ—Ñ—Ñ–µ—Ä–∞:', offerId);
    // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏
    document.getElementById('offerModal').style.display = 'flex';
}

function respondToOffer(offerId) {
    console.log('–û—Ç–∫–ª–∏–∫ –Ω–∞ –æ—Ñ—Ñ–µ—Ä:', offerId);
    showResponseModal(offerId);
}

function closeOfferModal() {
    document.getElementById('offerModal').style.display = 'none';
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç–∫–ª–∏–∫–∞
let currentOfferId = null;

async function showResponseModal(offerId) {
    try {
        currentOfferId = offerId;
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞
        const result = await fetch(`/api/offers/${offerId}`)
            .then(response => response.json());
        
        if (result.success) {
            const offer = result.offer;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞
            const offerDetailsHTML = `
                <div class="offer-summary">
                    <h4>${offer.title}</h4>
                    <div class="offer-meta">
                        <span class="offer-budget">üí∞ ${offer.budget_total || offer.price || '–ù–µ —É–∫–∞–∑–∞–Ω'} ‚ÇΩ</span>
                        <span class="offer-category">üìÇ ${offer.category || '–û–±—â–µ–µ'}</span>
                    </div>
                    <p class="offer-description">${offer.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    <div class="offer-requirements">
                        <strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong> ${offer.requirements || '–û—Å–æ–±—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –Ω–µ—Ç'}
                    </div>
                </div>
            `;
            
            document.getElementById('responseOfferDetails').innerHTML = offerDetailsHTML;
            document.getElementById('responseModal').style.display = 'flex';
            
        } else {
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ñ—Ñ–µ—Ä–∞');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ñ—Ñ–µ—Ä–∞');
    }
}

function closeResponseModal() {
    document.getElementById('responseModal').style.display = 'none';
    document.getElementById('responseMessage').value = '';
    currentOfferId = null;
}

async function submitResponse() {
    const message = document.getElementById('responseMessage').value.trim();
    
    if (!message) {
        alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—é');
        return;
    }
    
    if (!currentOfferId) {
        alert('–û—à–∏–±–∫–∞: –Ω–µ –≤—ã–±—Ä–∞–Ω –æ—Ñ—Ñ–µ—Ä');
        return;
    }
    
    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–∫–ª–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        const response = await fetch(`/api/offers/${currentOfferId}/respond-simple`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: message
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert(`‚úÖ ${result.message}`);
            closeResponseModal();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            const offerButton = document.querySelector(`button[onclick*="respondToOffer(${currentOfferId})"]`);
            if (offerButton) {
                offerButton.textContent = '‚úÖ –û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω';
                offerButton.disabled = true;
                offerButton.style.background = '#a0aec0';
                offerButton.onclick = null;
            }
        } else {
            alert(`‚ùå –û—à–∏–±–∫–∞: ${result.error}`);
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∫–ª–∏–∫–∞:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∫–ª–∏–∫–∞');
    }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ backdrop
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal-backdrop')) {
        if (e.target.id === 'offerModal') {
            closeOfferModal();
        } else if (e.target.id === 'responseModal') {
            closeResponseModal();
        }
    }
});
</script>

<style>
/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –æ—Ñ—Ñ–µ—Ä–æ–≤ */
.offer-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.offer-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
    flex: 1;
}

.offer-price {
    font-size: 18px;
    font-weight: 800;
    color: var(--primary-color);
    margin-left: 12px;
}

.offer-description {
    color: var(--text-secondary);
    font-size: 14px;
    margin-bottom: 16px;
    line-height: 1.5;
}

.offer-stats {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
}

.offer-stat {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.stat-label {
    font-size: 12px;
    color: var(--text-tertiary);
    font-weight: 600;
}

.stat-value {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
}

.offer-actions {
    display: flex;
    gap: 8px;
}

.payment-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 16px;
    border-radius: var(--border-radius);
    background: var(--bg-secondary);
    transition: var(--transition);
    margin-bottom: 12px;
}

.payment-item:hover {
    background: #f1f5f9;
    transform: translateX(4px);
}

.payment-info {
    flex: 1;
}

.payment-title {
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--text-primary);
}

.payment-date {
    color: var(--text-secondary);
    font-size: 12px;
}

.payment-amount {
    font-weight: 700;
    font-size: 16px;
    margin-right: 12px;
}

.payment-amount.success {
    color: var(--success-color);
}

.payment-amount.warning {
    color: var(--warning-color);
}

.badge {
    padding: 4px 8px;
    border-radius: var(--border-radius-sm);
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.badge-success {
    background: rgba(34, 197, 94, 0.1);
    color: #065f46;
}

.badge-warning {
    background: rgba(251, 191, 36, 0.1);
    color: #92400e;
}

.badge-info {
    background: rgba(59, 130, 246, 0.1);
    color: #1e40af;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç–∫–ª–∏–∫–∞ */
.offer-summary {
    background: var(--bg-secondary);
    padding: 16px;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 1px solid var(--border-color);
}

.offer-summary h4 {
    margin: 0 0 12px 0;
    color: var(--text-primary);
    font-size: 18px;
    font-weight: 700;
}

.offer-meta {
    display: flex;
    gap: 16px;
    margin-bottom: 12px;
    flex-wrap: wrap;
}

.offer-budget {
    color: var(--primary-color);
    font-weight: 700;
    font-size: 16px;
}

.offer-category {
    color: var(--text-secondary);
    font-size: 14px;
}

.offer-description {
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 12px;
}

.offer-requirements {
    color: var(--text-primary);
    font-size: 14px;
}

.form-help {
    font-size: 12px;
    color: var(--text-tertiary);
    margin-top: 8px;
    font-style: italic;
}

.required {
    color: var(--danger-color);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö */
.modal .btn {
    border-radius: 12px !important;
    font-weight: 600;
    padding: 12px 24px;
    transition: all 0.2s ease;
}

.modal .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.modal .btn-primary {
    background: linear-gradient(135deg, var(--primary-color), #5a67d8);
    border: none;
}

.modal .btn-secondary {
    background: linear-gradient(135deg, #a0aec0, #718096);
    border: none;
    color: white;
}

.modal .btn-outline {
    border: 2px solid var(--border-color);
    background: transparent;
    color: var(--text-primary);
}

.modal .btn-outline:hover {
    background: var(--bg-secondary);
    border-color: var(--primary-color);
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
.modal {
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
}

.modal-header {
    border-radius: 16px 16px 0 0;
    background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
}

.modal-footer {
    border-radius: 0 0 16px 16px;
    gap: 12px;
}

.modal-close {
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.modal-close:hover {
    transform: rotate(90deg);
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

@media (max-width: 768px) {
    .offer-header {
        flex-direction: column;
        gap: 8px;
    }
    
    .offer-price {
        margin-left: 0;
        align-self: flex-start;
    }
    
    .offer-stats {
        flex-direction: column;
        gap: 8px;
    }
    
    .offer-actions {
        flex-direction: column;
    }
    
    .payment-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .offer-meta {
        flex-direction: column;
        gap: 8px;
    }
}
</style>
{% endblock %}