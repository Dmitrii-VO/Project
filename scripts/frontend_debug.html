<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ Frontend API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { margin: 5px; padding: 10px 15px; }
        #results { white-space: pre-wrap; font-family: monospace; background: #f5f5f5; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>üîß –û—Ç–ª–∞–¥–∫–∞ Frontend API –¥–ª—è Offers</h1>
    
    <div class="test-section">
        <h3>–¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –æ—Ñ—Ñ–µ—Ä–∞</h3>
        <p>Telegram ID: <input type="text" id="telegramId" value="373086959" /></p>
        <p>–û—Ñ—Ñ–µ—Ä ID: <input type="text" id="offerId" value="36" /></p>
        <button onclick="testDeleteOffer()">üóëÔ∏è –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è</button>
        <button onclick="testGetMyOffers()">üìã –ü–æ–ª—É—á–∏—Ç—å –º–æ–∏ –æ—Ñ—Ñ–µ—Ä—ã</button>
        <button onclick="testAPI()">üß™ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç API</button>
    </div>
    
    <div id="results"></div>

    <script>
        // –£—Ç–∏–ª–∏—Ç—ã
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            results.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            console.log(message);
        }

        // –ò–º–∏—Ç–∞—Ü–∏—è getTelegramUserId
        window.getTelegramUserId = () => document.getElementById('telegramId').value;

        // API –∫–ª–∏–µ–Ω—Ç (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        class TestAPI {
            constructor() {
                this.baseUrl = '/api';
            }

            async request(url, options = {}) {
                const defaultOptions = {
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Telegram-User-Id': window.getTelegramUserId?.() || ''
                    }
                };

                const config = { ...defaultOptions, ...options };
                if (config.headers) {
                    config.headers = { ...defaultOptions.headers, ...config.headers };
                }

                log(`–ó–∞–ø—Ä–æ—Å: ${options.method || 'GET'} ${url}`);
                log(`–ó–∞–≥–æ–ª–æ–≤–∫–∏: ${JSON.stringify(config.headers, null, 2)}`);

                try {
                    const response = await fetch(url, config);
                    log(`–û—Ç–≤–µ—Ç: HTTP ${response.status}`);
                    
                    const data = await response.json();
                    log(`–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data, null, 2)}`);
                    
                    return { status: response.status, data };
                } catch (error) {
                    log(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                    throw error;
                }
            }

            async getMyOffers() {
                return this.request(`${this.baseUrl}/offers/my-offers`, { method: 'GET' });
            }

            async deleteOffer(id) {
                return this.request(`${this.baseUrl}/offers/${id}`, { method: 'DELETE' });
            }
        }

        const api = new TestAPI();

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function testDeleteOffer() {
            log('=== –¢–ï–°–¢ –£–î–ê–õ–ï–ù–ò–Ø –û–§–§–ï–†–ê ===');
            const offerId = document.getElementById('offerId').value;
            
            try {
                const result = await api.deleteOffer(offerId);
                if (result.status === 200) {
                    log('‚úÖ –û—Ñ—Ñ–µ—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success');
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${result.data.error}`, 'error');
                }
            } catch (error) {
                log(`üí• –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`, 'error');
            }
        }

        async function testGetMyOffers() {
            log('=== –¢–ï–°–¢ –ü–û–õ–£–ß–ï–ù–ò–Ø –û–§–§–ï–†–û–í ===');
            
            try {
                const result = await api.getMyOffers();
                if (result.status === 200 && result.data.success) {
                    const offers = result.data.data.offers;
                    log(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –æ—Ñ—Ñ–µ—Ä–æ–≤: ${offers.length}`, 'success');
                    offers.forEach(offer => {
                        log(`  –û—Ñ—Ñ–µ—Ä ID: ${offer.id}, –ù–∞–∑–≤–∞–Ω–∏–µ: ${offer.title}`);
                    });
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è: ${result.data.error}`, 'error');
                }
            } catch (error) {
                log(`üí• –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`, 'error');
            }
        }

        async function testAPI() {
            log('=== –ü–û–õ–ù–´–ô –¢–ï–°–¢ API ===');
            document.getElementById('results').innerHTML = '';
            
            await testGetMyOffers();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testDeleteOffer();
        }
    </script>
</body>
</html>