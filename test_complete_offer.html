<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ó–∞–≤–µ—Ä—à–∏—Ç—å</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –¥–ª—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤</h1>
    
    <div class="test-section">
        <h3>1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∞</h3>
        <button onclick="createTestOffer()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ñ—Ñ–µ—Ä</button>
        <div id="create-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –æ—Ñ—Ñ–µ—Ä–∞</h3>
        <input type="number" id="offer-id" placeholder="ID –æ—Ñ—Ñ–µ—Ä–∞" style="padding: 5px; margin: 5px;">
        <button onclick="getOfferDetails()">–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏</button>
        <div id="details-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç API —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∫–∞–Ω–∞–ª–æ–≤</h3>
        <button onclick="testChannelRecommendations()">–¢–µ—Å—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</button>
        <div id="recommendations-result" class="result"></div>
    </div>

    <script>
        async function createTestOffer() {
            const resultDiv = document.getElementById('create-result');
            try {
                const response = await fetch('/api/offers/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Telegram-User-Id': '373086959'
                    },
                    body: JSON.stringify({
                        title: '–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ó–∞–≤–µ—Ä—à–∏—Ç—å',
                        description: '–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É –∫–Ω–æ–ø–∫–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–ª—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤',
                        price: 5000,
                        budget_total: 5000,
                        category: 'general',
                        target_audience: '–¢–µ—Å—Ç–æ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏'
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    resultDiv.innerHTML = `‚úÖ –°–æ–∑–¥–∞–Ω –æ—Ñ—Ñ–µ—Ä ID: ${data.data.offer_id} - "${data.data.offer.title}"`;
                    document.getElementById('offer-id').value = data.data.offer_id;
                } else {
                    resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${data.error}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        async function getOfferDetails() {
            const offerId = document.getElementById('offer-id').value;
            const resultDiv = document.getElementById('details-result');
            
            if (!offerId) {
                resultDiv.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ ID –æ—Ñ—Ñ–µ—Ä–∞';
                return;
            }
            
            try {
                const response = await fetch(`/api/offers/${offerId}`, {
                    headers: {
                        'X-Telegram-User-Id': '373086959'
                    }
                });
                
                const data = await response.json();
                if (data.success) {
                    const offer = data.data.offer;
                    resultDiv.innerHTML = `
                        ‚úÖ –î–µ—Ç–∞–ª–∏ –æ—Ñ—Ñ–µ—Ä–∞:
                        <br>‚Ä¢ ID: ${offer.id}
                        <br>‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ: ${offer.title}
                        <br>‚Ä¢ –°—Ç–∞—Ç—É—Å: ${offer.status}
                        <br>‚Ä¢ –¶–µ–Ω–∞: ${offer.price}
                        <br>‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${offer.category}
                        <br>‚Ä¢ –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: ${offer.target_audience}
                    `;
                } else {
                    resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${data.error}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
        
        async function testChannelRecommendations() {
            const offerId = document.getElementById('offer-id').value;
            const resultDiv = document.getElementById('recommendations-result');
            
            if (!offerId) {
                resultDiv.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ ID –æ—Ñ—Ñ–µ—Ä–∞';
                return;
            }
            
            try {
                const response = await fetch('/api/channels/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Telegram-User-Id': '373086959'
                    },
                    body: JSON.stringify({
                        offer_id: parseInt(offerId),
                        title: '–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ –ó–∞–≤–µ—Ä—à–∏—Ç—å',
                        description: '–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É –∫–Ω–æ–ø–∫–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–ª—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤',
                        target_audience: '–¢–µ—Å—Ç–æ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏',
                        price: 5000,
                        category: 'general'
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    resultDiv.innerHTML = `
                        ‚úÖ –ü–æ–ª—É—á–µ–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π: ${data.channels.length}
                        <br>üìù –ü–µ—Ä–≤—ã–µ 3 –∫–∞–Ω–∞–ª–∞:
                        ${data.channels.slice(0, 3).map(ch => 
                            `<br>‚Ä¢ ${ch.title} (${ch.subscriber_count} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤, ${ch.price_per_post}‚ÇΩ)`
                        ).join('')}
                    `;
                } else {
                    resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${data.error}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }
    </script>
</body>
</html>