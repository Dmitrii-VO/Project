<!DOCTYPE html>
<html>
<head>
    <title>Final Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .debug-section h3 { margin-top: 0; color: #333; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>üîç –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</h1>
    
    <div class="debug-section">
        <h3>1. –¢–µ—Å—Ç API –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
        <div id="api-result">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div class="debug-section">
        <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTML —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h3>
        <div id="elements-result">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div class="debug-section">
        <h3>3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏</h3>
        <div id="card-test-result">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="test-card-container" style="border: 2px solid #007bff; padding: 10px; margin-top: 10px;"></div>
    </div>

    <script>
        // –≠–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è User ID
        window.getTelegramUserId = () => '373086959';
        
        async function runDebug() {
            // 1. –¢–µ—Å—Ç API
            try {
                const response = await fetch('/api/offers_moderation/offers?status=pending', {
                    headers: { 'X-Telegram-User-Id': '373086959' }
                });
                const data = await response.json();
                
                let apiResult = '';
                if (data.success && data.data.offers.length > 0) {
                    apiResult = `<span class="success">‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç: ${data.data.offers.length} –æ—Ñ—Ñ–µ—Ä–æ–≤</span>`;
                    apiResult += '<pre>' + JSON.stringify(data.data.offers[0], null, 2) + '</pre>';
                    
                    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
                    createTestCard(data.data.offers[0]);
                } else {
                    apiResult = `<span class="error">‚ùå API –Ω–µ –≤–µ—Ä–Ω—É–ª –æ—Ñ—Ñ–µ—Ä—ã</span>`;
                }
                document.getElementById('api-result').innerHTML = apiResult;
            } catch (error) {
                document.getElementById('api-result').innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ API: ${error.message}</span>`;
            }
            
            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            checkElements();
        }
        
        function checkElements() {
            const elements = [
                'moderationGrid',
                'moderationLoading', 
                'moderationEmpty',
                'admin-tab',
                'admin-moderation'
            ];
            
            let result = '<ul>';
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    const styles = window.getComputedStyle(el);
                    result += `<li><span class="success">‚úÖ ${id}</span> - display: ${styles.display}, visibility: ${styles.visibility}</li>`;
                } else {
                    result += `<li><span class="error">‚ùå ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω</span></li>`;
                }
            });
            result += '</ul>';
            
            document.getElementById('elements-result').innerHTML = result;
        }
        
        function createTestCard(offer) {
            const html = `
                <div class="offer-card moderation pending" data-offer-id="${offer.id}" style="border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 8px; background: #f9f9f9;">
                    <div class="offer-header" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <h3 style="margin: 0; color: #333;">${offer.title}</h3>
                        <span style="background: orange; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
                    </div>
                    <div style="background: #e9ecef; padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <div><strong>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${offer.user_name} (ID: ${offer.user_id})</div>
                        <div><strong>üìÖ –ü–æ–¥–∞–Ω–æ:</strong> ${offer.submitted_at}</div>
                    </div>
                    <div style="margin: 10px 0;">
                        <span style="font-weight: bold;">‚ÇΩ ${offer.budget_total}</span> | 
                        <span>${offer.category}</span>
                    </div>
                    <div style="margin: 10px 0; color: #666;">
                        ${offer.description.substring(0, 100)}...
                    </div>
                    <div style="display: flex; gap: 5px; margin-top: 15px;">
                        <button style="padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 3px;">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                        <button style="padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 3px;">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
                        <button style="padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 3px;">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        <button style="padding: 5px 10px; background: #6c757d; color: white; border: none; border-radius: 3px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `;
            
            document.getElementById('test-card-container').innerHTML = html;
            document.getElementById('card-test-result').innerHTML = '<span class="success">‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ</span>';
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç–ª–∞–¥–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', runDebug);
    </script>
</body>
</html>