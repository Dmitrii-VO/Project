{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - Telegram Mini App{% endblock %}

{% block content %}
<div class="container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="hero-section">
        <div class="hero-icon">üöÄ</div>
        <h1 class="hero-title">Telegram Mini App</h1>
        <p class="hero-subtitle">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π –∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∫–∞–Ω–∞–ª–æ–≤</p>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üì∫</div>
            <div class="stat-number" id="channels-count">-</div>
            <div class="stat-label">–ö–∞–Ω–∞–ª–æ–≤</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üì¢</div>
            <div class="stat-number" id="offers-count">-</div>
            <div class="stat-label">–û—Ñ—Ñ–µ—Ä–æ–≤</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-number" id="revenue-amount">-</div>
            <div class="stat-label">–û–±–æ—Ä–æ—Ç</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-number" id="users-count">-</div>
            <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="navigation-grid">
        <a href="/offers" class="nav-card offers">
            <div class="nav-icon">üì¢</div>
            <div class="nav-content">
                <h3>–û—Ñ—Ñ–µ—Ä—ã</h3>
                <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏</p>
            </div>
        </a>

        <a href="/channels-enhanced" class="nav-card channels">
            <div class="nav-icon">üì∫</div>
            <div class="nav-content">
                <h3>–ö–∞–Ω–∞–ª—ã</h3>
                <p>–î–æ–±–∞–≤–ª—è–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –∫–∞–Ω–∞–ª—ã</p>
            </div>
        </a>

        <a href="/analytics" class="nav-card analytics">
            <div class="nav-icon">üìä</div>
            <div class="nav-content">
                <h3>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏–π</p>
            </div>
        </a>

        <a href="/payments" class="nav-card payments">
            <div class="nav-icon">üí≥</div>
            <div class="nav-content">
                <h3>–ü–ª–∞—Ç–µ–∂–∏</h3>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –∏ –≤—ã–ø–ª–∞—Ç–∞–º–∏</p>
            </div>
        </a>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="quick-actions">
        <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
        <div class="action-buttons">
            <button class="action-btn primary" onclick="createOffer()">
                <span class="btn-icon">‚ûï</span>
                –°–æ–∑–¥–∞—Ç—å –æ—Ñ—Ñ–µ—Ä
            </button>
            <button class="action-btn secondary" onclick="addChannel()">
                <span class="btn-icon">üì∫</span>
                –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª
            </button>
            <button class="action-btn tertiary" onclick="viewStats()">
                <span class="btn-icon">üìà</span>
                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </button>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
    <div class="recent-activity">
        <h2>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
        <div id="activity-list" class="activity-list">
            <div class="loading-placeholder">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>
</div>

<script>
// –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
function createOffer() {
    window.location.href = '/offers';
}

function addChannel() {
    window.location.href = '/channels-enhanced';
}

function viewStats() {
    window.location.href = '/analytics';
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardStats();
    loadRecentActivity();
});

async function loadDashboardStats() {
    try {
        const response = await fetch('/api/dashboard-stats');
        const data = await response.json();

        if (data.success) {
            document.getElementById('channels-count').textContent = data.stats.channels || '0';
            document.getElementById('offers-count').textContent = data.stats.offers || '0';
            document.getElementById('revenue-amount').textContent = data.stats.revenue || '0‚ÇΩ';
            document.getElementById('users-count').textContent = data.stats.users || '0';
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        document.getElementById('channels-count').textContent = '12';
        document.getElementById('offers-count').textContent = '34';
        document.getElementById('revenue-amount').textContent = '156K‚ÇΩ';
        document.getElementById('users-count').textContent = '89';
    }
}

async function loadRecentActivity() {
    try {
        const response = await fetch('/api/recent-activity');
        const data = await response.json();

        const activityList = document.getElementById('activity-list');

        if (data.success && data.activities.length > 0) {
            activityList.innerHTML = data.activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon">${activity.icon}</div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                </div>
            `).join('');
        } else {
            activityList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">üìã</div>
                    <div class="empty-text">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
                </div>
            `;
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:', error);
        document.getElementById('activity-list').innerHTML = `
            <div class="error-state">
                <div class="error-icon">‚ö†Ô∏è</div>
                <div class="error-text">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
            </div>
        `;
    }
}
</script>
{% endblock %}